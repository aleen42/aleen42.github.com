(function(b){function a(e,c,d){this.elem=e;this.width=c||600;this.height=d||400;if(this.elem===null){this.elem=document.createElement("canvas");this.elem.id="canny__canvas";this.elem.width=this.width;this.elem.height=this.height}this.ctx=this.elem.getContext("2d");this.origImg={}}a.prototype.loadImg=function(e,h,f,c,g){var d=this;return new Promise(function(k,j){var i=new Image();i.onload=function(){d.width=c||i.width;d.height=g||i.height;d.elem.width=d.width;d.elem.height=d.height;d.ctx.drawImage(i,h||0,f||0,d.width,d.height);d.origImg.imgData=d.ctx.getImageData(0,0,d.width,d.height);k()};i.src=e})};a.prototype.runImg=function(g,h){var j=this;for(var k=0;k<this.height;k++){for(var d=0;d<this.width;d++){var f=d*4+k*this.width*4;var e=c(d,k,g);h(f,e)}}function c(m,s,q){if(!q){return}var n=[];for(var p=0,r=-(q-1)/2;p<q;p++,r++){n[p]=[];for(var o=0,l=-(q-1)/2;o<q;o++,l++){n[p][o]=(m+l)*4+(s+r)*j.width*4}}return n}};a.prototype.getOrigImgData=function(){var c=this.ctx.createImageData(this.width,this.height);c.data.set(this.origImg.imgData.data);return c};a.prototype.getCurrImgData=function(){return this.ctx.getImageData(0,0,this.width,this.height)};a.prototype.setImgData=function(c){this.ctx.putImageData(c,0,0)};a.prototype.setPixel=function(c,e,d){d.data[c]=typeof e=="number"?e:e.r;d.data[c+1]=typeof e=="number"?e:e.g;d.data[c+2]=typeof e=="number"?e:e.b};a.prototype.getPixel=function(c,d){if(c<0||c>d.data.length-4){return{r:255,g:255,b:255,a:255}}else{return this.getRGBA(c,d)}};a.prototype.getRGBA=function(d,c){return{r:c.data[d],g:c.data[d+1],b:c.data[d+2],a:c.data[d+3]}};a.prototype.getCanvas=function(){return this.elem};b.Canvas=a}(this));(function(f){var b=[[-1,0,1],[-2,0,2],[-1,0,1]];var a=[[1,2,1],[0,0,0],[-1,-2,-1]];var e=[[1,0],[0,-1]];var d=[[0,1],[-1,0]];var i=[[-1,0,1],[-1,0,1],[-1,0,1]];var g=[[-1,-1,-1],[0,0,0],[1,1,1]];var h={"sobel":{x:b,y:a,len:b.length},"roberts":{x:e,y:d,len:d.length},"prewitt":{x:i,y:g,len:g.length}};function c(j){this.canvas=j}c.prototype.gradient=function(o){var n=this.canvas.getCurrImgData(),j=this.canvas.getCurrImgData(),m=[],k=[],l=this;console.time("Sobel Filter Time");this.canvas.runImg(3,function(u,s){var t=edgeY=0,q=new Pixel(u,j.width,j.height);if(!q.isBorder()){for(var r=0;r<h[o].len;r++){for(var p=0;p<h[o].len;p++){t+=n.data[s[r][p]]*h[o]["x"][r][p];edgeY+=n.data[s[r][p]]*h[o]["y"][r][p]}}}m[u]=roundDir(Math.atan2(edgeY,t)*(180/Math.PI));k[u]=Math.round(Math.sqrt(t*t+edgeY*edgeY));l.canvas.setPixel(u,k[u],j)});console.timeEnd("Sobel Filter Time");this.canvas.dirMap=m;this.canvas.gradMap=k;return j};c.prototype.nonMaximumSuppress=function(){var j=this.canvas.getCurrImgData(),k=this;console.time("NMS Time");this.canvas.runImg(3,function(p,m){var l=getPixelNeighbors(k.canvas.dirMap[p]);var o=k.canvas.gradMap[m[l[0].x][l[0].y]];var n=k.canvas.gradMap[m[l[1].x][l[1].y]];if(o>k.canvas.gradMap[p]||n>k.canvas.gradMap[p]||(n===k.canvas.gradMap[p]&&o<k.canvas.gradMap[p])){k.canvas.setPixel(p,0,j)}});console.timeEnd("NMS Time");return j};c.prototype.hysteresis=function(){var n=this,j=this.canvas.getCurrImgData(),l=[],m=fastOtsu(this.canvas),k=m/2;console.time("Hysteresis Time");this.canvas.runImg(null,function(q){if(j.data[q]>m&&l[q]===undefined){var p=n._traverseEdge(q,j,k,[]);for(var o=0;o<p.length;o++){l[p[o]]=true}}});this.canvas.runImg(null,function(o){if(l[o]===undefined){n.canvas.setPixel(o,0,j)}else{n.canvas.setPixel(o,255,j)}});console.timeEnd("Hysteresis Time");return j};c.prototype.showDirMap=function(){var k=this,j=this.canvas.getCurrImgData();this.canvas.runImg(null,function(l){switch(k.canvas.dirMap[l]){case 0:k.canvas.setPixel(l,COLORS.RED,j);break;case 45:k.canvas.setPixel(l,COLORS.GREEN,j);break;case 90:k.canvas.setPixel(l,COLORS.BLUE,j);break;case 135:k.canvas.setPixel(l,COLORS.YELLOW,j);break;default:k.canvas.setPixel(l,COLORS.PINK,j)}});return j};c.prototype.showGradMap=function(){var k=this,j=this.canvas.getCurrImgData();this.canvas.runImg(null,function(l){if(k.canvas.gradMap[l]<0){k.canvas.setPixel(l,COLORS.RED,j)}else{if(k.canvas.gradMap[l]<200){k.canvas.setPixel(l,COLORS.GREEN,j)}else{if(k.canvas.gradMap[l]<400){k.canvas.setPixel(l,COLORS.BLUE,j)}else{if(k.canvas.gradMap[l]<600){k.canvas.setPixel(l,COLORS.YELLOW,j)}else{if(k.canvas.gradMap[l]<800){k.canvas.setPixel(l,COLORS.AQUA,j)}else{k.canvas.setPixel(l,COLORS.PINK,j)}}}}}});return j};c.prototype._traverseEdge=function(p,o,j,m){var n=[p];var l=getEdgeNeighbors(p,o,j,m);for(var k=0;k<l.length;k++){n=n.concat(this._traverseEdge(l[k],o,j,m.concat(n)))}return n};f.Canny=c}(this));function ContourFinder(){this.pixelsWidth;this.pixelsHeight;this.pixels;this.allContours;this.seen;this.offsetX;this.offsetY;this.init=function(d,a,g,c,e){this.allContours=[];this.seen=[];this.offsetX=parseInt(a);this.offsetY=parseInt(g);this.pixelsWidth=parseInt(c);this.pixelsHeight=parseInt(e);var b=d.getContext("2d");var f=b.getImageData(this.offsetX,this.offsetY,this.pixelsWidth,this.pixelsHeight);this.pixels=f.data};this.getPosition=function(a,b){return(b*this.pixelsWidth+a)*4
};this.getPixel=function(a,b){return{r:this.pixels[this.getPosition(a,b)],g:this.pixels[this.getPosition(a,b)+1],b:this.pixels[this.getPosition(a,b)+2],a:this.pixels[this.getPosition(a,b)+3]}};this.setPixel=function(a,c,b){this.pixels[this.getPosition(a,c)]=b[0];this.pixels[this.getPosition(a,c)+1]=b[1];this.pixels[this.getPosition(a,c)+2]=b[2];this.pixels[this.getPosition(a,c)+3]=b[3]};this.findContours=function(){var b=this.pixelsWidth;var e=this.pixelsHeight;var f=0;for(var g=0;g<e;g++){for(var a=0;a<b;a++){var c=this.getPixel(a,g);if(c.r===255){var d=this.followContour({x:a,y:g});if(d!==null){this.allContours.push(d)}}}}return this.allContours};this.markAsSeen=function(a){this.seen[a.x]=this.seen[a.x]||[];this.seen[a.x][a.y]=true};this.isSeen=function(a){if(this.seen[a.x]&&this.seen[a.x][a.y]){return true}return false};this.followContour=function(j){var f=[];f.push({x:j.x+this.offsetX,y:j.y+this.offsetY});this.markAsSeen(j);var b=this.pixelsWidth;var e=this.pixelsHeight;var a=j;var d=[{xd:-1,yd:0},{xd:-1,yd:-1},{xd:0,yd:-1},{xd:1,yd:-1},{xd:1,yd:0},{xd:1,yd:1},{xd:0,yd:1},{xd:-1,yd:1}];var g={x:a.x,y:a.y};var c=0;while(c<d.length){g.x=a.x+d[c].xd;g.y=a.y+d[c].yd;if(!this.isSeen(g)&&g.x<b&&g.y<e&&!(g.x===a.x&&g.y===a.y)&&this.getPixel(g.x,g.y).r===255){f.push({x:g.x+this.offsetX,y:g.y+this.offsetY});this.markAsSeen(g);a={x:g.x,y:g.y};c=0}else{g={x:a.x,y:a.y};c++}}if(f.length>8){return f}return null};this.getPoints=function(d){var c="";for(var b=0;b<d.length;b++){var a=d[b];c+=a.x+","+a.y+" > "}return c}}(function(b){function d(e){this.canvas=e}var c=function(e){return((0.3*e.r)+(0.59*e.g)+(0.11*e.b))};var a=function(q,s){var g=[];var r=2.718;for(var o=-(s-1)/2,n=0;n<s;o++,n++){g[n]=[];for(var p=-(s-1)/2,h=0;h<s;p++,h++){g[n][h]=1/(2*Math.PI*Math.pow(q,2))*Math.pow(r,-(Math.pow(Math.abs(p),2)+Math.pow(Math.abs(o),2))/(2*Math.pow(q,2)))}}var m=1/sumArr(g);for(var f=0;f<g.length;f++){for(var e=0;e<g[f].length;e++){g[f][e]=Math.round(m*g[f][e]*1000)/1000}}return g};d.prototype.grayscale=function(){var f=this.canvas.getCurrImgData(),g=this,e;console.time("Grayscale Time");this.canvas.runImg(null,function(h){e=c(g.canvas.getPixel(h,f));g.canvas.setPixel(h,e,f)});console.timeEnd("Grayscale Time");return f};d.prototype.gaussianBlur=function(h,f){var e=this.canvas.getCurrImgData(),g=this,i=a(h,f);console.time("Blur Time");this.canvas.runImg(f,function(p,o){var n=resultG=resultB=0,l;for(var m=0;m<f;m++){for(var k=0;k<f;k++){l=g.canvas.getPixel(o[m][k],e);n+=l.r*i[m][k];resultG+=l.g*i[m][k];resultB+=l.b*i[m][k]}}g.canvas.setPixel(p,{r:n,g:resultG,b:resultB},e)});console.timeEnd("Blur Time");return e};d.prototype.invertColors=function(){var f=this.canvas.getCurrImgData(),g=this,e;console.time("Invert Colors Time");this.canvas.runImg(null,function(h){e=g.canvas.getPixel(h,f);g.canvas.setPixel(h,{r:255-e.r,g:255-e.g,b:255-e.b},f)});console.timeEnd("Invert Colors Time");return f};b.Filters=d}(this));(function(a){a.sumArr=function(c){var b=0;c.map(function(e,d){b+=(/^\s*function Array/.test(String(e.constructor)))?a.sumArr(e):e});return b};a.COLORS={RED:{r:255,g:0,b:0},GREEN:{r:0,g:255,b:0},BLUE:{r:0,g:0,b:255},YELLOW:{r:255,g:255,b:0},PINK:{r:255,g:0,b:255},AQUA:{r:0,g:255,b:255}};a.roundDir=function(b){var b=b<0?b+180:b;if((b>=0&&b<=22.5)||(b>157.5&&b<=180)){return 0}else{if(b>22.5&&b<=67.5){return 45}else{if(b>67.5&&b<=112.5){return 90}else{if(b>112.5&&b<=157.5){return 135}}}}};a.getPixelNeighbors=function(b){var c={0:[{x:1,y:2},{x:1,y:0}],45:[{x:0,y:2},{x:2,y:0}],90:[{x:0,y:1},{x:2,y:1}],135:[{x:0,y:0},{x:2,y:2}]};return c[b]};a.getEdgeNeighbors=function(f,h,b,g){var e=[],d=new Pixel(f,h.width,h.height);for(var c=0;c<d.neighbors.length;c++){if(h.data[d.neighbors[c]]>=b&&(g===undefined||g.indexOf(d.neighbors[c])===-1)){e.push(d.neighbors[c])}}return e};a.createHistogram=function(f){var e={g:[]},b=256,c=0,d=f.getCurrImgData();while(b--){e.g[b]=0}f.runImg(null,function(g){e.g[d.data[g]]++;c++});e.length=c;return e};a.calcMeanThreshold=function(e){var d=a.createHistogram(e),b=0,c=d.length;d.g.forEach(function(g,f){b+=(g*(f+1))});return b/c};a.calcMedianThreshold=function(f){var d=createHistogram(f),b=Math.round(d.length/2),e=0,c;d.g.some(function(h,g){e+=h;if(e>=b){c=g;return true}else{return false}});return c};a.calcWeight=function(h,c,g){var d=h.reduce(function(k,e){return k+e},0);var f=(c===g)?[h[c]]:h.slice(c,g);var b=f.reduce(function(k,e){return k+e},0);return parseFloat(b,10)/d};a.calcMean=function(f,b,d){var c=(b===d)?[f[b]]:f.slice(b,d);var g=total=0;c.forEach(function(h,e){g+=((b+e)*h);total+=h});return parseFloat(g,10)/total};a.calcBetweenClassVariance=function(e,c,d,b){return e*d*(c-b)*(c-b)};a.fastOtsu=function(c){var k=a.createHistogram(c);var b=0;var d=k.g.length-1;var g,i,l,h;var f=[];var j=-Infinity,e;k.g.forEach(function(n,m){g=a.calcWeight(k.g,b,m);i=a.calcWeight(k.g,m,d+1);l=a.calcMean(k.g,b,m);h=a.calcMean(k.g,m,d+1);f[m]=a.calcBetweenClassVariance(g,l,i,h);if(f[m]>j){j=f[m];e=m}});return e}}(this));
(function(b){var a=["n","e","s","w","ne","nw","se","sw"];function c(e,d,f,j){var g=this;this.index=e;this.width=d;this.height=f;this.neighbors=[];this.cnvs=j;a.map(function(i,h){g.neighbors.push(g[i]())})}c.prototype.n=function(){return(this.index-this.width*4)};c.prototype.e=function(){return(this.index+4)};c.prototype.s=function(){return(this.index+this.width*4)};c.prototype.w=function(){return(this.index-4)};c.prototype.ne=function(){return(this.index-this.width*4+4)};c.prototype.nw=function(){return(this.index-this.width*4-4)};c.prototype.se=function(){return(this.index+this.width*4+4)};c.prototype.sw=function(){return(this.index+this.width*4-4)};c.prototype.r=function(){return this.cnvs[this.index]};c.prototype.g=function(){return this.cnvs[this.index+1]};c.prototype.b=function(){return this.cnvs[this.index+2]};c.prototype.a=function(){return this.cnvs[this.index+3]};c.prototype.isBorder=function(){return(this.index-(this.width*4))<0||(this.index%(this.width*4))===0||(this.index%(this.width*4))===((this.width*4)-4)||(this.index+(this.width*4))>(this.width*this.height*4)};b.Pixel=c}(this));(function(a){a.sumArr=function(c){var b=0;c.map(function(e,d){b+=(/^\s*function Array/.test(String(e.constructor)))?a.sumArr(e):e});return b};a.COLORS={RED:{r:255,g:0,b:0},GREEN:{r:0,g:255,b:0},BLUE:{r:0,g:0,b:255},YELLOW:{r:255,g:255,b:0},PINK:{r:255,g:0,b:255},AQUA:{r:0,g:255,b:255}};a.roundDir=function(b){var b=b<0?b+180:b;if((b>=0&&b<=22.5)||(b>157.5&&b<=180)){return 0}else{if(b>22.5&&b<=67.5){return 45}else{if(b>67.5&&b<=112.5){return 90}else{if(b>112.5&&b<=157.5){return 135}}}}};a.getPixelNeighbors=function(b){var c={0:[{x:1,y:2},{x:1,y:0}],45:[{x:0,y:2},{x:2,y:0}],90:[{x:0,y:1},{x:2,y:1}],135:[{x:0,y:0},{x:2,y:2}]};return c[b]};a.getEdgeNeighbors=function(f,h,b,g){var e=[],d=new Pixel(f,h.width,h.height);for(var c=0;c<d.neighbors.length;c++){if(h.data[d.neighbors[c]]>=b&&(g===undefined||g.indexOf(d.neighbors[c])===-1)){e.push(d.neighbors[c])}}return e};a.createHistogram=function(f){var e={g:[]},b=256,c=0,d=f.getCurrImgData();while(b--){e.g[b]=0}f.runImg(null,function(g){e.g[d.data[g]]++;c++});e.length=c;return e};a.calcMeanThreshold=function(e){var d=a.createHistogram(e),b=0,c=d.length;d.g.forEach(function(g,f){b+=(g*(f+1))});return b/c};a.calcMedianThreshold=function(f){var d=createHistogram(f),b=Math.round(d.length/2),e=0,c;d.g.some(function(h,g){e+=h;if(e>=b){c=g;return true}else{return false}});return c};a.calcWeight=function(h,c,g){var d=h.reduce(function(k,e){return k+e},0);var f=(c===g)?[h[c]]:h.slice(c,g);var b=f.reduce(function(k,e){return k+e},0);return parseFloat(b,10)/d};a.calcMean=function(f,b,d){var c=(b===d)?[f[b]]:f.slice(b,d);var g=total=0;c.forEach(function(h,e){g+=((b+e)*h);total+=h});return parseFloat(g,10)/total};a.calcBetweenClassVariance=function(e,c,d,b){return e*d*(c-b)*(c-b)};a.fastOtsu=function(c){var k=a.createHistogram(c);var b=0;var d=k.g.length-1;var g,i,l,h;var f=[];var j=-Infinity,e;k.g.forEach(function(n,m){g=a.calcWeight(k.g,b,m);i=a.calcWeight(k.g,m,d+1);l=a.calcMean(k.g,b,m);h=a.calcMean(k.g,m,d+1);f[m]=a.calcBetweenClassVariance(g,l,i,h);if(f[m]>j){j=f[m];e=m}});return e}}(this));(function(b){var a=["n","e","s","w","ne","nw","se","sw"];function c(e,d,f,j){var g=this;this.index=e;this.width=d;this.height=f;this.neighbors=[];this.cnvs=j;a.map(function(i,h){g.neighbors.push(g[i]())})}c.prototype.n=function(){return(this.index-this.width*4)};c.prototype.e=function(){return(this.index+4)};c.prototype.s=function(){return(this.index+this.width*4)};c.prototype.w=function(){return(this.index-4)};c.prototype.ne=function(){return(this.index-this.width*4+4)};c.prototype.nw=function(){return(this.index-this.width*4-4)};c.prototype.se=function(){return(this.index+this.width*4+4)};c.prototype.sw=function(){return(this.index+this.width*4-4)};c.prototype.r=function(){return this.cnvs[this.index]};c.prototype.g=function(){return this.cnvs[this.index+1]};c.prototype.b=function(){return this.cnvs[this.index+2]};c.prototype.a=function(){return this.cnvs[this.index+3]};c.prototype.isBorder=function(){return(this.index-(this.width*4))<0||(this.index%(this.width*4))===0||(this.index%(this.width*4))===((this.width*4)-4)||(this.index+(this.width*4))>(this.width*this.height*4)};b.Pixel=c}(this));(function(a){a.sumArr=function(c){var b=0;c.map(function(e,d){b+=(/^\s*function Array/.test(String(e.constructor)))?a.sumArr(e):e});return b};a.COLORS={RED:{r:255,g:0,b:0},GREEN:{r:0,g:255,b:0},BLUE:{r:0,g:0,b:255},YELLOW:{r:255,g:255,b:0},PINK:{r:255,g:0,b:255},AQUA:{r:0,g:255,b:255}};a.roundDir=function(b){var b=b<0?b+180:b;if((b>=0&&b<=22.5)||(b>157.5&&b<=180)){return 0}else{if(b>22.5&&b<=67.5){return 45}else{if(b>67.5&&b<=112.5){return 90}else{if(b>112.5&&b<=157.5){return 135}}}}};a.getPixelNeighbors=function(b){var c={0:[{x:1,y:2},{x:1,y:0}],45:[{x:0,y:2},{x:2,y:0}],90:[{x:0,y:1},{x:2,y:1}],135:[{x:0,y:0},{x:2,y:2}]};return c[b]};a.getEdgeNeighbors=function(f,h,b,g){var e=[],d=new Pixel(f,h.width,h.height);
for(var c=0;c<d.neighbors.length;c++){if(h.data[d.neighbors[c]]>=b&&(g===undefined||g.indexOf(d.neighbors[c])===-1)){e.push(d.neighbors[c])}}return e};a.createHistogram=function(f){var e={g:[]},b=256,c=0,d=f.getCurrImgData();while(b--){e.g[b]=0}f.runImg(null,function(g){e.g[d.data[g]]++;c++});e.length=c;return e};a.calcMeanThreshold=function(e){var d=a.createHistogram(e),b=0,c=d.length;d.g.forEach(function(g,f){b+=(g*(f+1))});return b/c};a.calcMedianThreshold=function(f){var d=createHistogram(f),b=Math.round(d.length/2),e=0,c;d.g.some(function(h,g){e+=h;if(e>=b){c=g;return true}else{return false}});return c};a.calcWeight=function(h,c,g){var d=h.reduce(function(k,e){return k+e},0);var f=(c===g)?[h[c]]:h.slice(c,g);var b=f.reduce(function(k,e){return k+e},0);return parseFloat(b,10)/d};a.calcMean=function(f,b,d){var c=(b===d)?[f[b]]:f.slice(b,d);var g=total=0;c.forEach(function(h,e){g+=((b+e)*h);total+=h});return parseFloat(g,10)/total};a.calcBetweenClassVariance=function(e,c,d,b){return e*d*(c-b)*(c-b)};a.fastOtsu=function(c){var k=a.createHistogram(c);var b=0;var d=k.g.length-1;var g,i,l,h;var f=[];var j=-Infinity,e;k.g.forEach(function(n,m){g=a.calcWeight(k.g,b,m);i=a.calcWeight(k.g,m,d+1);l=a.calcMean(k.g,b,m);h=a.calcMean(k.g,m,d+1);f[m]=a.calcBetweenClassVariance(g,l,i,h);if(f[m]>j){j=f[m];e=m}});return e}}(this));(function(b){var a=["n","e","s","w","ne","nw","se","sw"];function c(e,d,f,j){var g=this;this.index=e;this.width=d;this.height=f;this.neighbors=[];this.cnvs=j;a.map(function(i,h){g.neighbors.push(g[i]())})}c.prototype.n=function(){return(this.index-this.width*4)};c.prototype.e=function(){return(this.index+4)};c.prototype.s=function(){return(this.index+this.width*4)};c.prototype.w=function(){return(this.index-4)};c.prototype.ne=function(){return(this.index-this.width*4+4)};c.prototype.nw=function(){return(this.index-this.width*4-4)};c.prototype.se=function(){return(this.index+this.width*4+4)};c.prototype.sw=function(){return(this.index+this.width*4-4)};c.prototype.r=function(){return this.cnvs[this.index]};c.prototype.g=function(){return this.cnvs[this.index+1]};c.prototype.b=function(){return this.cnvs[this.index+2]};c.prototype.a=function(){return this.cnvs[this.index+3]};c.prototype.isBorder=function(){return(this.index-(this.width*4))<0||(this.index%(this.width*4))===0||(this.index%(this.width*4))===((this.width*4)-4)||(this.index+(this.width*4))>(this.width*this.height*4)};b.Pixel=c}(this));(function(a){a.sumArr=function(c){var b=0;c.map(function(e,d){b+=(/^\s*function Array/.test(String(e.constructor)))?a.sumArr(e):e});return b};a.COLORS={RED:{r:255,g:0,b:0},GREEN:{r:0,g:255,b:0},BLUE:{r:0,g:0,b:255},YELLOW:{r:255,g:255,b:0},PINK:{r:255,g:0,b:255},AQUA:{r:0,g:255,b:255}};a.roundDir=function(b){var b=b<0?b+180:b;if((b>=0&&b<=22.5)||(b>157.5&&b<=180)){return 0}else{if(b>22.5&&b<=67.5){return 45}else{if(b>67.5&&b<=112.5){return 90}else{if(b>112.5&&b<=157.5){return 135}}}}};a.getPixelNeighbors=function(b){var c={0:[{x:1,y:2},{x:1,y:0}],45:[{x:0,y:2},{x:2,y:0}],90:[{x:0,y:1},{x:2,y:1}],135:[{x:0,y:0},{x:2,y:2}]};return c[b]};a.getEdgeNeighbors=function(f,h,b,g){var e=[],d=new Pixel(f,h.width,h.height);for(var c=0;c<d.neighbors.length;c++){if(h.data[d.neighbors[c]]>=b&&(g===undefined||g.indexOf(d.neighbors[c])===-1)){e.push(d.neighbors[c])}}return e};a.createHistogram=function(f){var e={g:[]},b=256,c=0,d=f.getCurrImgData();while(b--){e.g[b]=0}f.runImg(null,function(g){e.g[d.data[g]]++;c++});e.length=c;return e};a.calcMeanThreshold=function(e){var d=a.createHistogram(e),b=0,c=d.length;d.g.forEach(function(g,f){b+=(g*(f+1))});return b/c};a.calcMedianThreshold=function(f){var d=createHistogram(f),b=Math.round(d.length/2),e=0,c;d.g.some(function(h,g){e+=h;if(e>=b){c=g;return true}else{return false}});return c};a.calcWeight=function(h,c,g){var d=h.reduce(function(k,e){return k+e},0);var f=(c===g)?[h[c]]:h.slice(c,g);var b=f.reduce(function(k,e){return k+e},0);return parseFloat(b,10)/d};a.calcMean=function(f,b,d){var c=(b===d)?[f[b]]:f.slice(b,d);var g=total=0;c.forEach(function(h,e){g+=((b+e)*h);total+=h});return parseFloat(g,10)/total};a.calcBetweenClassVariance=function(e,c,d,b){return e*d*(c-b)*(c-b)};a.fastOtsu=function(c){var k=a.createHistogram(c);var b=0;var d=k.g.length-1;var g,i,l,h;var f=[];var j=-Infinity,e;k.g.forEach(function(n,m){g=a.calcWeight(k.g,b,m);i=a.calcWeight(k.g,m,d+1);l=a.calcMean(k.g,b,m);h=a.calcMean(k.g,m,d+1);f[m]=a.calcBetweenClassVariance(g,l,i,h);if(f[m]>j){j=f[m];e=m}});return e}}(this));