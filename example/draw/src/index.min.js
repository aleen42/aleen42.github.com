(function(b){function a(e,c,d){this.elem=e;this.width=c||600;this.height=d||400;if(this.elem===null){this.elem=document.createElement("canvas");this.elem.id="canny__canvas";this.elem.width=this.width;this.elem.height=this.height}this.ctx=this.elem.getContext("2d");this.origImg={}}a.prototype.loadImg=function(e,h,f,c,g){var d=this;return new Promise(function(k,j){var i=new Image();i.onload=function(){d.width=c||i.width;d.height=g||i.height;d.elem.width=d.width;d.elem.height=d.height;d.ctx.drawImage(i,h||0,f||0,d.width,d.height);d.origImg.imgData=d.ctx.getImageData(0,0,d.width,d.height);k()};i.src=e})};a.prototype.runImg=function(g,h){var j=this;for(var k=0;k<this.height;k++){for(var d=0;d<this.width;d++){var f=d*4+k*this.width*4;var e=c(d,k,g);h(f,e)}}function c(m,s,q){if(!q){return}var n=[];for(var p=0,r=-(q-1)/2;p<q;p++,r++){n[p]=[];for(var o=0,l=-(q-1)/2;o<q;o++,l++){n[p][o]=(m+l)*4+(s+r)*j.width*4}}return n}};a.prototype.getOrigImgData=function(){var c=this.ctx.createImageData(this.width,this.height);c.data.set(this.origImg.imgData.data);return c};a.prototype.getCurrImgData=function(){return this.ctx.getImageData(0,0,this.width,this.height)};a.prototype.setImgData=function(c){this.ctx.putImageData(c,0,0)};a.prototype.setPixel=function(c,e,d){d.data[c]=typeof e=="number"?e:e.r;d.data[c+1]=typeof e=="number"?e:e.g;d.data[c+2]=typeof e=="number"?e:e.b};a.prototype.getPixel=function(c,d){if(c<0||c>d.data.length-4){return{r:255,g:255,b:255,a:255}}else{return this.getRGBA(c,d)}};a.prototype.getRGBA=function(d,c){return{r:c.data[d],g:c.data[d+1],b:c.data[d+2],a:c.data[d+3]}};a.prototype.getCanvas=function(){return this.elem};b.Canvas=a}(this));(function(f){var b=[[-1,0,1],[-2,0,2],[-1,0,1]];var a=[[1,2,1],[0,0,0],[-1,-2,-1]];var e=[[1,0],[0,-1]];var d=[[0,1],[-1,0]];var i=[[-1,0,1],[-1,0,1],[-1,0,1]];var g=[[-1,-1,-1],[0,0,0],[1,1,1]];var h={"sobel":{x:b,y:a,len:b.length},"roberts":{x:e,y:d,len:d.length},"prewitt":{x:i,y:g,len:g.length}};function c(j){this.canvas=j}c.prototype.gradient=function(o){var n=this.canvas.getCurrImgData(),j=this.canvas.getCurrImgData(),m=[],k=[],l=this;console.time("Sobel Filter Time");this.canvas.runImg(3,function(u,s){var t=edgeY=0,q=new Pixel(u,j.width,j.height);if(!q.isBorder()){for(var r=0;r<h[o].len;r++){for(var p=0;p<h[o].len;p++){t+=n.data[s[r][p]]*h[o]["x"][r][p];edgeY+=n.data[s[r][p]]*h[o]["y"][r][p]}}}m[u]=roundDir(Math.atan2(edgeY,t)*(180/Math.PI));k[u]=Math.round(Math.sqrt(t*t+edgeY*edgeY));l.canvas.setPixel(u,k[u],j)});console.timeEnd("Sobel Filter Time");this.canvas.dirMap=m;this.canvas.gradMap=k;return j};c.prototype.nonMaximumSuppress=function(){var j=this.canvas.getCurrImgData(),k=this;console.time("NMS Time");this.canvas.runImg(3,function(p,m){var l=getPixelNeighbors(k.canvas.dirMap[p]);var o=k.canvas.gradMap[m[l[0].x][l[0].y]];var n=k.canvas.gradMap[m[l[1].x][l[1].y]];if(o>k.canvas.gradMap[p]||n>k.canvas.gradMap[p]||(n===k.canvas.gradMap[p]&&o<k.canvas.gradMap[p])){k.canvas.setPixel(p,0,j)}});console.timeEnd("NMS Time");return j};c.prototype.hysteresis=function(){var n=this,j=this.canvas.getCurrImgData(),l=[],m=fastOtsu(this.canvas),k=m/2;console.time("Hysteresis Time");this.canvas.runImg(null,function(q){if(j.data[q]>m&&l[q]===undefined){var p=n._traverseEdge(q,j,k,[]);for(var o=0;o<p.length;o++){l[p[o]]=true}}});this.canvas.runImg(null,function(o){if(l[o]===undefined){n.canvas.setPixel(o,0,j)}else{n.canvas.setPixel(o,255,j)}});console.timeEnd("Hysteresis Time");return j};c.prototype.showDirMap=function(){var k=this,j=this.canvas.getCurrImgData();this.canvas.runImg(null,function(l){switch(k.canvas.dirMap[l]){case 0:k.canvas.setPixel(l,COLORS.RED,j);break;case 45:k.canvas.setPixel(l,COLORS.GREEN,j);break;case 90:k.canvas.setPixel(l,COLORS.BLUE,j);break;case 135:k.canvas.setPixel(l,COLORS.YELLOW,j);break;default:k.canvas.setPixel(l,COLORS.PINK,j)}});return j};c.prototype.showGradMap=function(){var k=this,j=this.canvas.getCurrImgData();this.canvas.runImg(null,function(l){if(k.canvas.gradMap[l]<0){k.canvas.setPixel(l,COLORS.RED,j)}else{if(k.canvas.gradMap[l]<200){k.canvas.setPixel(l,COLORS.GREEN,j)}else{if(k.canvas.gradMap[l]<400){k.canvas.setPixel(l,COLORS.BLUE,j)}else{if(k.canvas.gradMap[l]<600){k.canvas.setPixel(l,COLORS.YELLOW,j)}else{if(k.canvas.gradMap[l]<800){k.canvas.setPixel(l,COLORS.AQUA,j)}else{k.canvas.setPixel(l,COLORS.PINK,j)}}}}}});return j};c.prototype._traverseEdge=function(p,o,j,m){var n=[p];var l=getEdgeNeighbors(p,o,j,m);for(var k=0;k<l.length;k++){n=n.concat(this._traverseEdge(l[k],o,j,m.concat(n)))}return n};f.Canny=c}(this));function ContourFinder(){this.pixelsWidth;this.pixelsHeight;this.pixels;this.allContours;this.seen;this.offsetX;this.offsetY;this.init=function(d,a,g,c,e){this.allContours=[];this.seen=[];this.offsetX=parseInt(a);this.offsetY=parseInt(g);this.pixelsWidth=parseInt(c);this.pixelsHeight=parseInt(e);var b=d.getContext("2d");var f=b.getImageData(this.offsetX,this.offsetY,this.pixelsWidth,this.pixelsHeight);this.pixels=f.data};this.getPosition=function(a,b){return(b*this.pixelsWidth+a)*4
};this.getPixel=function(a,b){return{r:this.pixels[this.getPosition(a,b)],g:this.pixels[this.getPosition(a,b)+1],b:this.pixels[this.getPosition(a,b)+2],a:this.pixels[this.getPosition(a,b)+3]}};this.setPixel=function(a,c,b){this.pixels[this.getPosition(a,c)]=b[0];this.pixels[this.getPosition(a,c)+1]=b[1];this.pixels[this.getPosition(a,c)+2]=b[2];this.pixels[this.getPosition(a,c)+3]=b[3]};this.findContours=function(){var b=this.pixelsWidth;var e=this.pixelsHeight;var f=0;for(var g=0;g<e;g++){for(var a=0;a<b;a++){var c=this.getPixel(a,g);if(c.r===255){var d=this.followContour({x:a,y:g});if(d!==null){this.allContours.push(d)}}}}return this.allContours};this.markAsSeen=function(a){this.seen[a.x]=this.seen[a.x]||[];this.seen[a.x][a.y]=true};this.isSeen=function(a){if(this.seen[a.x]&&this.seen[a.x][a.y]){return true}return false};this.followContour=function(j){var f=[];f.push({x:j.x+this.offsetX,y:j.y+this.offsetY});this.markAsSeen(j);var b=this.pixelsWidth;var e=this.pixelsHeight;var a=j;var d=[{xd:-1,yd:0},{xd:-1,yd:-1},{xd:0,yd:-1},{xd:1,yd:-1},{xd:1,yd:0},{xd:1,yd:1},{xd:0,yd:1},{xd:-1,yd:1}];var g={x:a.x,y:a.y};var c=0;while(c<d.length){g.x=a.x+d[c].xd;g.y=a.y+d[c].yd;if(!this.isSeen(g)&&g.x<b&&g.y<e&&!(g.x===a.x&&g.y===a.y)&&this.getPixel(g.x,g.y).r===255){f.push({x:g.x+this.offsetX,y:g.y+this.offsetY});this.markAsSeen(g);a={x:g.x,y:g.y};c=0}else{g={x:a.x,y:a.y};c++}}if(f.length>8){return f}return null};this.getPoints=function(d){var c="";for(var b=0;b<d.length;b++){var a=d[b];c+=a.x+","+a.y+" > "}return c}}(function(b){function d(e){this.canvas=e}var c=function(e){return((0.3*e.r)+(0.59*e.g)+(0.11*e.b))};var a=function(q,s){var g=[];var r=2.718;for(var o=-(s-1)/2,n=0;n<s;o++,n++){g[n]=[];for(var p=-(s-1)/2,h=0;h<s;p++,h++){g[n][h]=1/(2*Math.PI*Math.pow(q,2))*Math.pow(r,-(Math.pow(Math.abs(p),2)+Math.pow(Math.abs(o),2))/(2*Math.pow(q,2)))}}var m=1/sumArr(g);for(var f=0;f<g.length;f++){for(var e=0;e<g[f].length;e++){g[f][e]=Math.round(m*g[f][e]*1000)/1000}}return g};d.prototype.grayscale=function(){var f=this.canvas.getCurrImgData(),g=this,e;console.time("Grayscale Time");this.canvas.runImg(null,function(h){e=c(g.canvas.getPixel(h,f));g.canvas.setPixel(h,e,f)});console.timeEnd("Grayscale Time");return f};d.prototype.gaussianBlur=function(h,f){var e=this.canvas.getCurrImgData(),g=this,i=a(h,f);console.time("Blur Time");this.canvas.runImg(f,function(p,o){var n=resultG=resultB=0,l;for(var m=0;m<f;m++){for(var k=0;k<f;k++){l=g.canvas.getPixel(o[m][k],e);n+=l.r*i[m][k];resultG+=l.g*i[m][k];resultB+=l.b*i[m][k]}}g.canvas.setPixel(p,{r:n,g:resultG,b:resultB},e)});console.timeEnd("Blur Time");return e};d.prototype.invertColors=function(){var f=this.canvas.getCurrImgData(),g=this,e;console.time("Invert Colors Time");this.canvas.runImg(null,function(h){e=g.canvas.getPixel(h,f);g.canvas.setPixel(h,{r:255-e.r,g:255-e.g,b:255-e.b},f)});console.timeEnd("Invert Colors Time");return f};b.Filters=d}(this));(function(a){a.sumArr=function(c){var b=0;c.map(function(e,d){b+=(/^\s*function Array/.test(String(e.constructor)))?a.sumArr(e):e});return b};a.COLORS={RED:{r:255,g:0,b:0},GREEN:{r:0,g:255,b:0},BLUE:{r:0,g:0,b:255},YELLOW:{r:255,g:255,b:0},PINK:{r:255,g:0,b:255},AQUA:{r:0,g:255,b:255}};a.roundDir=function(b){var b=b<0?b+180:b;if((b>=0&&b<=22.5)||(b>157.5&&b<=180)){return 0}else{if(b>22.5&&b<=67.5){return 45}else{if(b>67.5&&b<=112.5){return 90}else{if(b>112.5&&b<=157.5){return 135}}}}};a.getPixelNeighbors=function(b){var c={0:[{x:1,y:2},{x:1,y:0}],45:[{x:0,y:2},{x:2,y:0}],90:[{x:0,y:1},{x:2,y:1}],135:[{x:0,y:0},{x:2,y:2}]};return c[b]};a.getEdgeNeighbors=function(f,h,b,g){var e=[],d=new Pixel(f,h.width,h.height);for(var c=0;c<d.neighbors.length;c++){if(h.data[d.neighbors[c]]>=b&&(g===undefined||g.indexOf(d.neighbors[c])===-1)){e.push(d.neighbors[c])}}return e};a.createHistogram=function(f){var e={g:[]},b=256,c=0,d=f.getCurrImgData();while(b--){e.g[b]=0}f.runImg(null,function(g){e.g[d.data[g]]++;c++});e.length=c;return e};a.calcMeanThreshold=function(e){var d=a.createHistogram(e),b=0,c=d.length;d.g.forEach(function(g,f){b+=(g*(f+1))});return b/c};a.calcMedianThreshold=function(f){var d=createHistogram(f),b=Math.round(d.length/2),e=0,c;d.g.some(function(h,g){e+=h;if(e>=b){c=g;return true}else{return false}});return c};a.calcWeight=function(h,c,g){var d=h.reduce(function(k,e){return k+e},0);var f=(c===g)?[h[c]]:h.slice(c,g);var b=f.reduce(function(k,e){return k+e},0);return parseFloat(b,10)/d};a.calcMean=function(f,b,d){var c=(b===d)?[f[b]]:f.slice(b,d);var g=total=0;c.forEach(function(h,e){g+=((b+e)*h);total+=h});return parseFloat(g,10)/total};a.calcBetweenClassVariance=function(e,c,d,b){return e*d*(c-b)*(c-b)};a.fastOtsu=function(c){var k=a.createHistogram(c);var b=0;var d=k.g.length-1;var g,i,l,h;var f=[];var j=-Infinity,e;k.g.forEach(function(n,m){g=a.calcWeight(k.g,b,m);i=a.calcWeight(k.g,m,d+1);l=a.calcMean(k.g,b,m);h=a.calcMean(k.g,m,d+1);f[m]=a.calcBetweenClassVariance(g,l,i,h);if(f[m]>j){j=f[m];e=m}});return e}}(this));
(function(b){var a=["n","e","s","w","ne","nw","se","sw"];function c(e,d,f,j){var g=this;this.index=e;this.width=d;this.height=f;this.neighbors=[];this.cnvs=j;a.map(function(i,h){g.neighbors.push(g[i]())})}c.prototype.n=function(){return(this.index-this.width*4)};c.prototype.e=function(){return(this.index+4)};c.prototype.s=function(){return(this.index+this.width*4)};c.prototype.w=function(){return(this.index-4)};c.prototype.ne=function(){return(this.index-this.width*4+4)};c.prototype.nw=function(){return(this.index-this.width*4-4)};c.prototype.se=function(){return(this.index+this.width*4+4)};c.prototype.sw=function(){return(this.index+this.width*4-4)};c.prototype.r=function(){return this.cnvs[this.index]};c.prototype.g=function(){return this.cnvs[this.index+1]};c.prototype.b=function(){return this.cnvs[this.index+2]};c.prototype.a=function(){return this.cnvs[this.index+3]};c.prototype.isBorder=function(){return(this.index-(this.width*4))<0||(this.index%(this.width*4))===0||(this.index%(this.width*4))===((this.width*4)-4)||(this.index+(this.width*4))>(this.width*this.height*4)};b.Pixel=c}(this));(function(a){a.sumArr=function(c){var b=0;c.map(function(e,d){b+=(/^\s*function Array/.test(String(e.constructor)))?a.sumArr(e):e});return b};a.COLORS={RED:{r:255,g:0,b:0},GREEN:{r:0,g:255,b:0},BLUE:{r:0,g:0,b:255},YELLOW:{r:255,g:255,b:0},PINK:{r:255,g:0,b:255},AQUA:{r:0,g:255,b:255}};a.roundDir=function(b){var b=b<0?b+180:b;if((b>=0&&b<=22.5)||(b>157.5&&b<=180)){return 0}else{if(b>22.5&&b<=67.5){return 45}else{if(b>67.5&&b<=112.5){return 90}else{if(b>112.5&&b<=157.5){return 135}}}}};a.getPixelNeighbors=function(b){var c={0:[{x:1,y:2},{x:1,y:0}],45:[{x:0,y:2},{x:2,y:0}],90:[{x:0,y:1},{x:2,y:1}],135:[{x:0,y:0},{x:2,y:2}]};return c[b]};a.getEdgeNeighbors=function(f,h,b,g){var e=[],d=new Pixel(f,h.width,h.height);for(var c=0;c<d.neighbors.length;c++){if(h.data[d.neighbors[c]]>=b&&(g===undefined||g.indexOf(d.neighbors[c])===-1)){e.push(d.neighbors[c])}}return e};a.createHistogram=function(f){var e={g:[]},b=256,c=0,d=f.getCurrImgData();while(b--){e.g[b]=0}f.runImg(null,function(g){e.g[d.data[g]]++;c++});e.length=c;return e};a.calcMeanThreshold=function(e){var d=a.createHistogram(e),b=0,c=d.length;d.g.forEach(function(g,f){b+=(g*(f+1))});return b/c};a.calcMedianThreshold=function(f){var d=createHistogram(f),b=Math.round(d.length/2),e=0,c;d.g.some(function(h,g){e+=h;if(e>=b){c=g;return true}else{return false}});return c};a.calcWeight=function(h,c,g){var d=h.reduce(function(k,e){return k+e},0);var f=(c===g)?[h[c]]:h.slice(c,g);var b=f.reduce(function(k,e){return k+e},0);return parseFloat(b,10)/d};a.calcMean=function(f,b,d){var c=(b===d)?[f[b]]:f.slice(b,d);var g=total=0;c.forEach(function(h,e){g+=((b+e)*h);total+=h});return parseFloat(g,10)/total};a.calcBetweenClassVariance=function(e,c,d,b){return e*d*(c-b)*(c-b)};a.fastOtsu=function(c){var k=a.createHistogram(c);var b=0;var d=k.g.length-1;var g,i,l,h;var f=[];var j=-Infinity,e;k.g.forEach(function(n,m){g=a.calcWeight(k.g,b,m);i=a.calcWeight(k.g,m,d+1);l=a.calcMean(k.g,b,m);h=a.calcMean(k.g,m,d+1);f[m]=a.calcBetweenClassVariance(g,l,i,h);if(f[m]>j){j=f[m];e=m}});return e}}(this));(function(b){var a=["n","e","s","w","ne","nw","se","sw"];function c(e,d,f,j){var g=this;this.index=e;this.width=d;this.height=f;this.neighbors=[];this.cnvs=j;a.map(function(i,h){g.neighbors.push(g[i]())})}c.prototype.n=function(){return(this.index-this.width*4)};c.prototype.e=function(){return(this.index+4)};c.prototype.s=function(){return(this.index+this.width*4)};c.prototype.w=function(){return(this.index-4)};c.prototype.ne=function(){return(this.index-this.width*4+4)};c.prototype.nw=function(){return(this.index-this.width*4-4)};c.prototype.se=function(){return(this.index+this.width*4+4)};c.prototype.sw=function(){return(this.index+this.width*4-4)};c.prototype.r=function(){return this.cnvs[this.index]};c.prototype.g=function(){return this.cnvs[this.index+1]};c.prototype.b=function(){return this.cnvs[this.index+2]};c.prototype.a=function(){return this.cnvs[this.index+3]};c.prototype.isBorder=function(){return(this.index-(this.width*4))<0||(this.index%(this.width*4))===0||(this.index%(this.width*4))===((this.width*4)-4)||(this.index+(this.width*4))>(this.width*this.height*4)};b.Pixel=c}(this));(function(a){a.sumArr=function(c){var b=0;c.map(function(e,d){b+=(/^\s*function Array/.test(String(e.constructor)))?a.sumArr(e):e});return b};a.COLORS={RED:{r:255,g:0,b:0},GREEN:{r:0,g:255,b:0},BLUE:{r:0,g:0,b:255},YELLOW:{r:255,g:255,b:0},PINK:{r:255,g:0,b:255},AQUA:{r:0,g:255,b:255}};a.roundDir=function(b){var b=b<0?b+180:b;if((b>=0&&b<=22.5)||(b>157.5&&b<=180)){return 0}else{if(b>22.5&&b<=67.5){return 45}else{if(b>67.5&&b<=112.5){return 90}else{if(b>112.5&&b<=157.5){return 135}}}}};a.getPixelNeighbors=function(b){var c={0:[{x:1,y:2},{x:1,y:0}],45:[{x:0,y:2},{x:2,y:0}],90:[{x:0,y:1},{x:2,y:1}],135:[{x:0,y:0},{x:2,y:2}]};return c[b]};a.getEdgeNeighbors=function(f,h,b,g){var e=[],d=new Pixel(f,h.width,h.height);
for(var c=0;c<d.neighbors.length;c++){if(h.data[d.neighbors[c]]>=b&&(g===undefined||g.indexOf(d.neighbors[c])===-1)){e.push(d.neighbors[c])}}return e};a.createHistogram=function(f){var e={g:[]},b=256,c=0,d=f.getCurrImgData();while(b--){e.g[b]=0}f.runImg(null,function(g){e.g[d.data[g]]++;c++});e.length=c;return e};a.calcMeanThreshold=function(e){var d=a.createHistogram(e),b=0,c=d.length;d.g.forEach(function(g,f){b+=(g*(f+1))});return b/c};a.calcMedianThreshold=function(f){var d=createHistogram(f),b=Math.round(d.length/2),e=0,c;d.g.some(function(h,g){e+=h;if(e>=b){c=g;return true}else{return false}});return c};a.calcWeight=function(h,c,g){var d=h.reduce(function(k,e){return k+e},0);var f=(c===g)?[h[c]]:h.slice(c,g);var b=f.reduce(function(k,e){return k+e},0);return parseFloat(b,10)/d};a.calcMean=function(f,b,d){var c=(b===d)?[f[b]]:f.slice(b,d);var g=total=0;c.forEach(function(h,e){g+=((b+e)*h);total+=h});return parseFloat(g,10)/total};a.calcBetweenClassVariance=function(e,c,d,b){return e*d*(c-b)*(c-b)};a.fastOtsu=function(c){var k=a.createHistogram(c);var b=0;var d=k.g.length-1;var g,i,l,h;var f=[];var j=-Infinity,e;k.g.forEach(function(n,m){g=a.calcWeight(k.g,b,m);i=a.calcWeight(k.g,m,d+1);l=a.calcMean(k.g,b,m);h=a.calcMean(k.g,m,d+1);f[m]=a.calcBetweenClassVariance(g,l,i,h);if(f[m]>j){j=f[m];e=m}});return e}}(this));(function(b){var a=["n","e","s","w","ne","nw","se","sw"];function c(e,d,f,j){var g=this;this.index=e;this.width=d;this.height=f;this.neighbors=[];this.cnvs=j;a.map(function(i,h){g.neighbors.push(g[i]())})}c.prototype.n=function(){return(this.index-this.width*4)};c.prototype.e=function(){return(this.index+4)};c.prototype.s=function(){return(this.index+this.width*4)};c.prototype.w=function(){return(this.index-4)};c.prototype.ne=function(){return(this.index-this.width*4+4)};c.prototype.nw=function(){return(this.index-this.width*4-4)};c.prototype.se=function(){return(this.index+this.width*4+4)};c.prototype.sw=function(){return(this.index+this.width*4-4)};c.prototype.r=function(){return this.cnvs[this.index]};c.prototype.g=function(){return this.cnvs[this.index+1]};c.prototype.b=function(){return this.cnvs[this.index+2]};c.prototype.a=function(){return this.cnvs[this.index+3]};c.prototype.isBorder=function(){return(this.index-(this.width*4))<0||(this.index%(this.width*4))===0||(this.index%(this.width*4))===((this.width*4)-4)||(this.index+(this.width*4))>(this.width*this.height*4)};b.Pixel=c}(this));(function(a){a.sumArr=function(c){var b=0;c.map(function(e,d){b+=(/^\s*function Array/.test(String(e.constructor)))?a.sumArr(e):e});return b};a.COLORS={RED:{r:255,g:0,b:0},GREEN:{r:0,g:255,b:0},BLUE:{r:0,g:0,b:255},YELLOW:{r:255,g:255,b:0},PINK:{r:255,g:0,b:255},AQUA:{r:0,g:255,b:255}};a.roundDir=function(b){var b=b<0?b+180:b;if((b>=0&&b<=22.5)||(b>157.5&&b<=180)){return 0}else{if(b>22.5&&b<=67.5){return 45}else{if(b>67.5&&b<=112.5){return 90}else{if(b>112.5&&b<=157.5){return 135}}}}};a.getPixelNeighbors=function(b){var c={0:[{x:1,y:2},{x:1,y:0}],45:[{x:0,y:2},{x:2,y:0}],90:[{x:0,y:1},{x:2,y:1}],135:[{x:0,y:0},{x:2,y:2}]};return c[b]};a.getEdgeNeighbors=function(f,h,b,g){var e=[],d=new Pixel(f,h.width,h.height);for(var c=0;c<d.neighbors.length;c++){if(h.data[d.neighbors[c]]>=b&&(g===undefined||g.indexOf(d.neighbors[c])===-1)){e.push(d.neighbors[c])}}return e};a.createHistogram=function(f){var e={g:[]},b=256,c=0,d=f.getCurrImgData();while(b--){e.g[b]=0}f.runImg(null,function(g){e.g[d.data[g]]++;c++});e.length=c;return e};a.calcMeanThreshold=function(e){var d=a.createHistogram(e),b=0,c=d.length;d.g.forEach(function(g,f){b+=(g*(f+1))});return b/c};a.calcMedianThreshold=function(f){var d=createHistogram(f),b=Math.round(d.length/2),e=0,c;d.g.some(function(h,g){e+=h;if(e>=b){c=g;return true}else{return false}});return c};a.calcWeight=function(h,c,g){var d=h.reduce(function(k,e){return k+e},0);var f=(c===g)?[h[c]]:h.slice(c,g);var b=f.reduce(function(k,e){return k+e},0);return parseFloat(b,10)/d};a.calcMean=function(f,b,d){var c=(b===d)?[f[b]]:f.slice(b,d);var g=total=0;c.forEach(function(h,e){g+=((b+e)*h);total+=h});return parseFloat(g,10)/total};a.calcBetweenClassVariance=function(e,c,d,b){return e*d*(c-b)*(c-b)};a.fastOtsu=function(c){var k=a.createHistogram(c);var b=0;var d=k.g.length-1;var g,i,l,h;var f=[];var j=-Infinity,e;k.g.forEach(function(n,m){g=a.calcWeight(k.g,b,m);i=a.calcWeight(k.g,m,d+1);l=a.calcMean(k.g,b,m);h=a.calcMean(k.g,m,d+1);f[m]=a.calcBetweenClassVariance(g,l,i,h);if(f[m]>j){j=f[m];e=m}});return e}}(this));
function download(A,f,p){var o=window,l="application/octet-stream",s=p||l,k=A,n=document,w=n.createElement("a"),i=function(b){return String(b)},q=o.Blob||o.MozBlob||o.WebKitBlob||i,d=o.MSBlobBuilder||o.WebKitBlobBuilder||o.BlobBuilder,h=f||"download",c,v,t,g;if(String(this)==="true"){k=[k,s];s=k[0];k=k[1]}if(String(k).match(/^data\:[\w+\-]+\/[\w+\-]+[,;]/)){return navigator.msSaveBlob?navigator.msSaveBlob(e(k),h):r(k)}try{c=k instanceof q?k:new q([k],{type:s})}catch(j){if(d){v=new d();v.append([k]);c=v.getBlob(s)}}function e(a){var z=a.split(/[:;,]/),x=z[1],C=z[2]=="base64"?atob:decodeURIComponent,m=C(z.pop()),B=m.length,b=0,y=new Uint8Array(B);for(b;b<B;++b){y[b]=m.charCodeAt(b)}return new q([y],{type:x})}function r(a,m){if("download" in w){w.href=a;w.setAttribute("download",h);w.innerHTML="downloading...";n.body.appendChild(w);setTimeout(function(){w.click();n.body.removeChild(w);if(m===true){setTimeout(function(){o.URL.revokeObjectURL(w.href)},250)}},66);return true}var b=n.createElement("iframe");n.body.appendChild(b);if(!m){a="data:"+a.replace(/^data:([\w\/\-\+]+)/,l)}b.src=a;setTimeout(function(){n.body.removeChild(b)},333)}if(navigator.msSaveBlob){return navigator.msSaveBlob(c,h)}if(o.URL){r(o.URL.createObjectURL(c),true)}else{if(typeof c==="string"||c.constructor===i){try{return r("data:"+s+";base64,"+o.btoa(c))}catch(j){return r("data:"+s+","+encodeURIComponent(c))}}g=new FileReader();g.onload=function(a){r(this.result)};g.readAsDataURL(c)}return true};
!function(){"use strict";function t(t){return t&&t.Object===Object?t:null}function e(t){return String("0000000"+t).slice(-7)}function i(){function t(){return Math.floor(65536*(1+Math.random())).toString(16).substring(1)}return t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()}function o(t){var e={};this.settings=t,this.on=function(t,i){e[t]=i},this.emit=function(t){var i=e[t];i&&i.apply(null,Array.prototype.slice.call(arguments,1))},this.filename=t.name||i(),this.extension="",this.mimeType=""}function n(t){o.call(this,t),this.extension=".tar",this.mimeType="application/x-tar",this.fileExtension="",this.tape=null,this.count=0}function r(t){n.call(this,t),this.type="image/png",this.fileExtension=".png"}function a(t){n.call(this,t),this.type="image/jpeg",this.fileExtension=".jpg",this.quality=t.quality/100||.8}function s(t){var e=document.createElement("canvas");"image/webp"!==e.toDataURL("image/webp").substr(5,10)&&console.log("WebP not supported - try another export format"),o.call(this,t),t.quality=t.quality/100||.8,this.extension=".webm",this.mimeType="video/webm",this.baseFilename=this.filename,this.frames=[],this.part=1}function c(t){o.call(this,t),t.quality=t.quality/100||.8,this.encoder=new FFMpegServer.Video(t),this.encoder.on("process",function(){this.emit("process")}.bind(this)),this.encoder.on("finished",function(t,e){var i=this.callback;i&&(this.callback=void 0,i(t,e))}.bind(this)),this.encoder.on("progress",function(t){this.settings.onProgress&&this.settings.onProgress(t)}.bind(this)),this.encoder.on("error",function(t){alert(JSON.stringify(t,null,2))}.bind(this))}function p(t){o.call(this,t),this.framerate=this.settings.framerate,this.type="video/webm",this.extension=".webm",this.stream=null,this.mediaRecorder=null,this.chunks=[]}function h(t){o.call(this,t),t.quality=31-(30*t.quality/100||10),t.workers=t.workers||4,this.extension=".gif",this.mimeType="image/gif",this.canvas=document.createElement("canvas"),this.ctx=this.canvas.getContext("2d"),this.sizeSet=!1,this.encoder=new GIF({workers:t.workers,quality:t.quality,workerScript:t.workersPath+"gif.worker.js"}),this.encoder.on("progress",function(t){this.settings.onProgress&&this.settings.onProgress(t)}.bind(this)),this.encoder.on("finished",function(t){var e=this.callback;e&&(this.callback=void 0,e(t))}.bind(this))}function m(t){function e(){function t(){return this._hooked||(this._hooked=!0,this._hookedTime=this.currentTime||0,this.pause(),et.push(this)),this._hookedTime+E.startTime}b("Capturer start"),j=window.Date.now(),S=j+E.startTime,I=window.performance.now(),B=I+E.startTime,window.Date.prototype.getTime=function(){return S},window.Date.now=function(){return S},window.setTimeout=function(t,e){var i={callback:t,time:e,triggerTime:S+e};return q.push(i),b("Timeout set to "+i.time),i},window.clearTimeout=function(t){for(var e=0;e<q.length;e++)q[e]!=t||(q.splice(e,1),b("Timeout cleared"))},window.setInterval=function(t,e){var i={callback:t,time:e,triggerTime:S+e};return L.push(i),b("Interval set to "+i.time),i},window.clearInterval=function(t){return b("clear Interval"),null},window.requestAnimationFrame=function(t){R.push(t)},window.performance.now=function(){return B};try{Object.defineProperty(HTMLVideoElement.prototype,"currentTime",{get:t}),Object.defineProperty(HTMLAudioElement.prototype,"currentTime",{get:t})}catch(e){b(e)}}function i(){e(),O.start(),M=!0}function o(){M=!1,O.stop(),d()}function n(t,e){K(t,0,e)}function m(){n(y)}function d(){b("Capturer stop"),window.setTimeout=K,window.setInterval=Q,window.clearTimeout=X,window.requestAnimationFrame=Y,window.Date.prototype.getTime=tt,window.Date.now=Z,window.performance.now=$}function u(){var t=P/E.framerate;(E.frameLimit&&P>=E.frameLimit||E.timeLimit&&t>=E.timeLimit)&&(o(),v());var e=new Date(null);e.setSeconds(t),E.motionBlurFrames>2?z.textContent="CCapture "+E.format+" | "+P+" frames ("+A+" inter) | "+e.toISOString().substr(11,8):z.textContent="CCapture "+E.format+" | "+P+" frames | "+e.toISOString().substr(11,8),E.onProcess&&E.onProcess(P)}function f(t){(V.width!==t.width||V.height!==t.height)&&(V.width=t.width,V.height=t.height,_=new Uint16Array(V.height*V.width*4),W.fillStyle="#0",W.fillRect(0,0,V.width,V.height))}function l(t){W.drawImage(t,0,0),H=W.getImageData(0,0,V.width,V.height);for(var e=0;e<_.length;e+=4)_[e]+=H.data[e],_[e+1]+=H.data[e+1],_[e+2]+=H.data[e+2];A++}function w(){for(var t=H.data,e=0;e<_.length;e+=4)t[e]=2*_[e]/E.motionBlurFrames,t[e+1]=2*_[e+1]/E.motionBlurFrames,t[e+2]=2*_[e+2]/E.motionBlurFrames;W.putImageData(H,0,0),O.add(V),P++,A=0,b("Full MB Frame! "+P+" "+S);for(var e=0;e<_.length;e+=4)_[e]=0,_[e+1]=0,_[e+2]=0;gc()}function g(t){if("webm"===E.format){var e=document.createElement("canvas"),i=e.getContext("2d");e.width=t.width,e.height=t.height,i.fillStyle=E.bakckgroundColor,i.fillRect(0,0,t.width,t.height),i.drawImage(t,0,0)}M&&(E.motionBlurFrames>2?(f(e),l(e),A>=.5*E.motionBlurFrames?w():m()):(O.add(e),P++,b("Full Frame! "+P)))}function y(){var t=1e3/E.framerate,e=(P+A/E.motionBlurFrames)*t;S=j+e,B=I+e,et.forEach(function(t){t._hookedTime=e/1e3}),u(),b("Frame: "+P+" "+A);for(var i=0;i<q.length;i++)S>=q[i].triggerTime&&(n(q[i].callback),q.splice(i,1));for(var i=0;i<L.length;i++)S>=L[i].triggerTime&&(n(L[i].callback),L[i].triggerTime+=L[i].time);R.forEach(function(t){n(t,S-T)}),R=[]}function v(t){t||(t=function(t){return download(t,O.filename+O.extension,O.mimeType),!1}),O.save(t)}function b(t){C&&console.log(t)}function k(t,e){U[t]=e}function x(t){var e=U[t];e&&e.apply(null,Array.prototype.slice.call(arguments,1))}function F(t){x("progress",t)}var C,D,S,j,B,I,m,O,E=t||{},q=(new Date,[]),L=[],P=0,A=0,R=[],M=!1,U={};E.framerate=E.framerate||60,E.motionBlurFrames=2*(E.motionBlurFrames||1),C=E.verbose||!1,D=E.display||!1,E.step=1e3/E.framerate,E.timeLimit=E.timeLimit||0,E.frameLimit=E.frameLimit||0,E.startTime=E.startTime||0;var z=document.createElement("div");z.style.position="absolute",z.style.left=z.style.top=0,z.style.backgroundColor="black",z.style.fontFamily="monospace",z.style.fontSize="11px",z.style.padding="5px",z.style.color="red",z.style.zIndex=1e5,E.display&&document.body.appendChild(z);var _,H,V=document.createElement("canvas"),W=V.getContext("2d");b("Step is set to "+E.step+"ms");var G={gif:h,webm:s,ffmpegserver:c,png:r,jpg:a,"webm-mediarecorder":p},J=G[E.format];if(!J)throw"Error: Incorrect or missing format: Valid formats are "+Object.keys(G).join(", ");if(O=new J(E),O.step=m,O.on("process",y),O.on("progress",F),"performance"in window==0&&(window.performance={}),Date.now=Date.now||function(){return(new Date).getTime()},"now"in window.performance==0){var N=Date.now();performance.timing&&performance.timing.navigationStart&&(N=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-N}}var K=window.setTimeout,Q=window.setInterval,X=window.clearTimeout,Y=window.requestAnimationFrame,Z=window.Date.now,$=window.performance.now,tt=window.Date.prototype.getTime,et=[];return{start:i,capture:g,stop:o,save:v,on:k}}var d={"function":!0,object:!0},u=(parseFloat,parseInt,d[typeof exports]&&exports&&!exports.nodeType?exports:void 0),f=d[typeof module]&&module&&!module.nodeType?module:void 0,l=f&&f.exports===u?u:void 0,w=t(u&&f&&"object"==typeof global&&global),g=t(d[typeof self]&&self),y=t(d[typeof window]&&window),v=t(d[typeof this]&&this),b=w||y!==(v&&v.window)&&y||g||v||Function("return this")();"gc"in window||(window.gc=function(){}),HTMLCanvasElement.prototype.toBlob||Object.defineProperty(HTMLCanvasElement.prototype,"toBlob",{value:function(t,e,i){for(var o=atob(this.toDataURL(e,i).split(",")[1]),n=o.length,r=new Uint8Array(n),a=0;n>a;a++)r[a]=o.charCodeAt(a);t(new Blob([r],{type:e||"image/png"}))}}),function(){if("performance"in window==0&&(window.performance={}),Date.now=Date.now||function(){return(new Date).getTime()},"now"in window.performance==0){var t=Date.now();performance.timing&&performance.timing.navigationStart&&(t=performance.timing.navigationStart),window.performance.now=function(){return Date.now()-t}}}();var T=window.Date.now();o.prototype.start=function(){},o.prototype.stop=function(){},o.prototype.add=function(){},o.prototype.save=function(){},o.prototype.dispose=function(){},o.prototype.safeToProceed=function(){return!0},o.prototype.step=function(){console.log("Step not set!")},n.prototype=Object.create(o.prototype),n.prototype.start=function(){this.dispose()},n.prototype.add=function(t){var i=new FileReader;i.onload=function(){this.tape.append(e(this.count)+this.fileExtension,new Uint8Array(i.result)),this.count++,this.step()}.bind(this),i.readAsArrayBuffer(t)},n.prototype.save=function(t){t(this.tape.save())},n.prototype.dispose=function(){this.tape=new Tar,this.count=0},r.prototype=Object.create(n.prototype),r.prototype.add=function(t){t.toBlob(function(t){n.prototype.add.call(this,t)}.bind(this),this.type)},a.prototype=Object.create(n.prototype),a.prototype.add=function(t){t.toBlob(function(t){n.prototype.add.call(this,t)}.bind(this),this.type,this.quality)},s.prototype=Object.create(o.prototype),s.prototype.start=function(t){this.dispose()},s.prototype.add=function(t){this.frames.push(t.toDataURL("image/webp",this.quality)),this.settings.autoSaveTime>0&&this.frames.length/this.settings.framerate>=this.settings.autoSaveTime?this.save(function(t){this.filename=this.baseFilename+"-part-"+e(this.part),download(t,this.filename+this.extension,this.mimeType),this.dispose(),this.part++,this.filename=this.baseFilename+"-part-"+e(this.part),this.step()}.bind(this)):this.step()},s.prototype.save=function(t){if(this.frames.length){var e=Whammy.fromImageArray(this.frames,this.settings.framerate),i=new Blob([e],{type:"octet/stream"});t(i)}},s.prototype.dispose=function(t){this.frames=[]},c.prototype=Object.create(o.prototype),c.prototype.start=function(){this.encoder.start(this.settings)},c.prototype.add=function(t){this.encoder.add(t)},c.prototype.save=function(t){this.callback=t,this.encoder.end()},c.prototype.safeToProceed=function(){return this.encoder.safeToProceed()},p.prototype=Object.create(o.prototype),p.prototype.add=function(t){this.stream||(this.stream=t.captureStream(this.framerate),this.mediaRecorder=new MediaRecorder(this.stream),this.mediaRecorder.start(),this.mediaRecorder.ondataavailable=function(t){this.chunks.push(t.data)}.bind(this)),this.step()},p.prototype.save=function(t){this.mediaRecorder.onstop=function(e){var i=new Blob(this.chunks,{type:"video/webm"});this.chunks=[],t(i)}.bind(this),this.mediaRecorder.stop()},h.prototype=Object.create(o.prototype),h.prototype.add=function(t){this.sizeSet||(this.encoder.setOption("width",t.width),this.encoder.setOption("height",t.height),this.sizeSet=!0),this.canvas.width=t.width,this.canvas.height=t.height,this.ctx.drawImage(t,0,0),this.encoder.addFrame(this.ctx,{copy:!0,delay:this.settings.step}),this.step()},h.prototype.save=function(t){this.callback=t,this.encoder.render()},(y||g||{}).CCapture=m,"function"==typeof define&&"object"==typeof define.amd&&define.amd?define(function(){return m}):u&&f?(l&&((f.exports=m).CCapture=m),u.CCapture=m):b.CCapture=m}();
window.Whammy=function(){function t(t,e){for(var r=a(t),i=3e4,n=[{id:440786851,data:[{data:1,id:17030},{data:1,id:17143},{data:4,id:17138},{data:8,id:17139},{data:"webm",id:17026},{data:2,id:17031},{data:2,id:17029}]},{id:408125543,data:[{id:357149030,data:[{data:1e6,id:2807729},{data:"whammy",id:19840},{data:"whammy",id:22337},{data:f(r.duration),id:17545}]},{id:374648427,data:[{id:174,data:[{data:1,id:215},{data:1,id:29637},{data:0,id:156},{data:"und",id:2274716},{data:"V_VP8",id:134},{data:"VP8",id:2459272},{data:1,id:131},{id:224,data:[{data:r.width,id:176},{data:r.height,id:186}]}]}]},{id:475249515,data:[]}]}],o=n[1],h=o.data[2],s=0,m=0;s<t.length;){var g={id:187,data:[{data:Math.round(m),id:179},{id:183,data:[{data:1,id:247},{data:0,size:8,id:241}]}]};h.data.push(g);var c=[],p=0;do c.push(t[s]),p+=t[s].duration,s++;while(s<t.length&&i>p);var l=0,v={id:524531317,data:[{data:Math.round(m),id:231}].concat(c.map(function(t){var a=u({discardable:0,frame:t.data.slice(4),invisible:0,keyframe:1,lacing:0,trackNum:1,timecode:Math.round(l)});return l+=t.duration,{data:a,id:163}}))};o.data.push(v),m+=p}for(var w=0,y=0;y<o.data.length;y++){y>=3&&(h.data[y-3].data[1].data[1].data=w);var b=d([o.data[y]],e);w+=b.size||b.byteLength||b.length,2!=y&&(o.data[y]=b)}return d(n,e)}function a(t){for(var a=t[0].width,e=t[0].height,r=t[0].duration,i=1;i<t.length;i++){if(t[i].width!=a)throw"Frame "+(i+1)+" has a different width";if(t[i].height!=e)throw"Frame "+(i+1)+" has a different height";if(t[i].duration<0||t[i].duration>32767)throw"Frame "+(i+1)+" has a weird duration (must be between 0 and 32767)";r+=t[i].duration}return{duration:r,width:a,height:e}}function e(t){for(var a=[];t>0;)a.push(255&t),t>>=8;return new Uint8Array(a.reverse())}function r(t,a){for(var e=new Uint8Array(a),r=a-1;r>=0;r--)e[r]=255&t,t>>=8;return e}function i(t){for(var a=new Uint8Array(t.length),e=0;e<t.length;e++)a[e]=t.charCodeAt(e);return a}function n(t){var a=[],e=t.length%8?new Array(9-t.length%8).join("0"):"";t=e+t;for(var r=0;r<t.length;r+=8)a.push(parseInt(t.substr(r,8),2));return new Uint8Array(a)}function d(t,a){for(var u=[],h=0;h<t.length;h++)if("id"in t[h]){var s=t[h].data;if("object"==typeof s&&(s=d(s,a)),"number"==typeof s&&(s="size"in t[h]?r(s,t[h].size):n(s.toString(2))),"string"==typeof s&&(s=i(s)),s.length);for(var f=s.size||s.byteLength||s.length,m=0,g=56;g>0;g-=7)if(f>Math.pow(2,g)-2){m=g/7;break}var c=f.toString(2),p=new Array(8*(m+1)+1).join("0"),l=new Array(m+1).join("0")+1,v=p.substr(0,p.length-c.length-l.length)+c,w=l+v;u.push(e(t[h].id)),u.push(n(w)),u.push(s)}else u.push(t[h]);if(a){var y=o(u);return new Uint8Array(y)}return new Blob(u,{type:"video/webm"})}function o(t,a){null==a&&(a=[]);for(var e=0;e<t.length;e++)"object"==typeof t[e]?o(t[e],a):a.push(t[e]);return a}function u(t){var a=0;if(t.keyframe&&(a|=128),t.invisible&&(a|=8),t.lacing&&(a|=t.lacing<<1),t.discardable&&(a|=1),t.trackNum>127)throw"TrackNumber > 127 not supported";var e=[128|t.trackNum,t.timecode>>8,255&t.timecode,a].map(function(t){return String.fromCharCode(t)}).join("")+t.frame;return e}function h(t){for(var a=t.RIFF[0].WEBP[0],e=a.indexOf("Â*"),r=0,i=[];4>r;r++)i[r]=a.charCodeAt(e+3+r);var n,d,o,u,h;return h=i[1]<<8|i[0],n=16383&h,d=h>>14,h=i[3]<<8|i[2],o=16383&h,u=h>>14,{width:n,height:o,data:a,riff:t}}function s(t){for(var a=0,e={};a<t.length;){var r=t.substr(a,4);if(e[r]=e[r]||[],"RIFF"==r||"LIST"==r){var i=parseInt(t.substr(a+4,4).split("").map(function(t){var a=t.charCodeAt(0).toString(2);return new Array(8-a.length+1).join("0")+a}).join(""),2),n=t.substr(a+4+4,i);a+=8+i,e[r].push(s(n))}else"WEBP"==r?(e[r].push(t.substr(a+8)),a=t.length):(e[r].push(t.substr(a+4)),a=t.length)}return e}function f(t){return[].slice.call(new Uint8Array(new Float64Array([t]).buffer),0).map(function(t){return String.fromCharCode(t)}).reverse().join("")}function m(t,a){this.frames=[],this.duration=1e3/t,this.quality=a||.8}return m.prototype.add=function(t,a){if("undefined"!=typeof a&&this.duration)throw"you can't pass a duration if the fps is set";if("undefined"==typeof a&&!this.duration)throw"if you don't have the fps set, you need to have durations here.";if(t.canvas&&(t=t.canvas),t.toDataURL)t=t.getContext("2d").getImageData(0,0,t.width,t.height);else if("string"!=typeof t)throw"frame must be a a HTMLCanvasElement, a CanvasRenderingContext2D or a DataURI formatted string";if("string"==typeof t&&!/^data:image\/webp;base64,/gi.test(t))throw"Input must be formatted properly as a base64 encoded DataURI of type image/webp";this.frames.push({image:t,duration:a||this.duration})},m.prototype.encodeFrames=function(t){if(this.frames[0].image instanceof ImageData){var a=this.frames,e=document.createElement("canvas"),r=e.getContext("2d");e.width=this.frames[0].image.width,e.height=this.frames[0].image.height;var i=function(n){var d=a[n];r.putImageData(d.image,0,0),d.image=e.toDataURL("image/webp",this.quality),n<a.length-1?setTimeout(function(){i(n+1)},1):t()}.bind(this);i(0)}else t()},m.prototype.compile=function(a,e){this.encodeFrames(function(){var r=new t(this.frames.map(function(t){var a=h(s(atob(t.image.slice(23))));return a.duration=t.duration,a}),a);e(r)}.bind(this))},{Video:m,fromImageArray:function(a,e,r){return t(a.map(function(t){var a=h(s(atob(t.slice(23))));return a.duration=1e3/e,a}),r)},toWebM:t}}();
var time={texts:{},start:function(t){this.texts[t]=(new Date).valueOf()},end:function(t){var e=(new Date).valueOf()-this.texts[t];this.mark(t+': <span class="font-a10000 font-bold">'+e+"</span> ms")},mark:function(t,e){if(e=e||null,null===e||"undefined"==typeof this.texts[e]){var n=document.createElement("p");n.className="paragraph-padding",n.innerHTML=t,document.querySelectorAll(".container__info")[0].appendChild(n),this.texts[e]=n}else this.texts[e].innerHTML=t},clear:function(){this.texts={}}},canvasObj={instance:null,imgs:[],fixedDrag:!1,stage:null,layer:null,canvas:null,contourFinder:null,capturer:null,pathSum:0,pointSum:0,contextStates:null,init:function(t,e,n){this.stage=new Konva.Stage({container:t,width:e,height:n});var a=!1;if(this.layer=new Konva.Layer,this.layer.canvas._canvas.className="canvas__panel",this.stage.add(this.layer),this.instance=this.layer.canvas._canvas,this.instance.addEventListener){document.onkeydown=function(t){var e=t.which||t.keyCode;16===e&&(this.fixedDrag=!0)}.bind(this),document.onkeyup=function(t){var e=t.which||t.keyCode;16===e&&(this.fixedDrag=!1)}.bind(this);var s=document.createElement("div");s.className="notice__drop",s.innerText="Drop the image",this.instance.parentElement.appendChild(s),this.instance.addEventListener("dragover",function(t){t.preventDefault(),a||(s.style.opacity=1,a=!0)},!1),this.instance.addEventListener("dragleave",function(t){t.preventDefault(),a&&(s.style.opacity=0,a=!1)},!1),this.instance.addEventListener("drop",function(t){a&&(s.style.opacity=0,a=!1);var e=t.dataTransfer.files;if(e.length>0){var n=e[0];if("undefined"!=typeof FileReader&&-1!==n.type.indexOf("image")){var i=new FileReader;i.onload=function(t){var e=document.createElement("img");e.addEventListener("load",function(){const t=e.width/e.height,n=.8;var a=e.width,s=e.height;if(e.width>n*parseInt(this.instance.getAttribute("width"))||e.height>n*parseInt(this.instance.getAttribute("height"))){const i=t/(parseInt(this.instance.getAttribute("width"))/parseInt(this.instance.getAttribute("height")));a=1>i?n*parseInt(this.instance.getAttribute("height"))*t:n*parseInt(this.instance.getAttribute("width")),s=1>i?n*parseInt(this.instance.getAttribute("height")):n*parseInt(this.instance.getAttribute("width"))/t}var r=new Konva.Image({width:a,height:s});r.on("mouseout",function(){document.body.style.cursor="default"}),r.image(e);var o=new Konva.Group({x:(parseInt(this.instance.getAttribute("width"))-a)/2,y:(parseInt(this.instance.getAttribute("height"))-s)/2,draggable:!0});o.add(r),this.addAnchor(o,0,0,"topLeft"),this.addAnchor(o,a,0,"topRight"),this.addAnchor(o,0,s,"bottomLeft"),this.addAnchor(o,a,s,"bottomRight"),o.on("dragmove",function(){o.opacity(1),this.layer.draw();for(var t=0;t<o.children.length;t++){var e=o.children[t];"Circle"===e.className&&e.attrs.visible===!1&&(e.show(),this.layer.draw())}}.bind(this)),this.layer.add(o),this.layer.draw();this.imgs.push({group:o,oriX:(parseInt(this.instance.getAttribute("width"))-a)/2,oriY:(parseInt(this.instance.getAttribute("height"))-s)/2})-1;r.on("mouseover",function(){document.body.style.cursor="move"}.bind(this))}.bind(this),!1),e.src=t.target.result}.bind(this),i.readAsDataURL(n)}}t.preventDefault()}.bind(this))}else this.instance.attachEvent},addAnchor:function(t){var e=(t.getStage(),t.getLayer(),4===arguments.length?new Konva.Circle({x:arguments[1],y:arguments[2],stroke:"#666",fill:"#ddd",strokeWidth:2,radius:8,name:arguments[3],draggable:!0,dragOnTop:!1}):arguments[1]),n=function(t){var e=t.getParent(),n=e.get(".topLeft")[0],a=e.get(".topRight")[0],s=e.get(".bottomRight")[0],i=e.get(".bottomLeft")[0],r=e.get("Image")[0];r.position(n.position());var o=t.getX(),h=t.getY();switch(t.getName()){case"topLeft":var c=i.getY()-n.getY(),d=this.fixedDrag?c*r.attrs.width/r.attrs.height:a.getX()-n.getX();i.setX(this.fixedDrag?s.getX()-d:o),r.position({x:s.position().x-d,y:s.position().y-c}),this.fixedDrag&&n.setX(a.getX()-d),a.setY(h);break;case"topRight":var c=i.getY()-n.getY(),d=this.fixedDrag?c*r.attrs.width/r.attrs.height:a.getX()-n.getX();s.setX(this.fixedDrag?i.getX()+d:o),this.fixedDrag&&a.setX(n.getX()+d),n.setY(h);break;case"bottomRight":var d=a.getX()-n.getX(),c=this.fixedDrag?d*r.attrs.height/r.attrs.width:i.getY()-n.getY();i.setY(this.fixedDrag?n.getY()+c:h),this.fixedDrag&&s.setY(a.getY()+c),a.setX(o);break;case"bottomLeft":var d=a.getX()-n.getX(),c=this.fixedDrag?d*r.attrs.height/r.attrs.width:i.getY()-n.getY();s.setY(this.fixedDrag?a.getY()+c:h),this.fixedDrag&&i.setY(n.getY()+c),n.setX(o)}d&&c&&(r.width(d),r.height(c))}.bind(this);e.on("dragmove",function(){n(e),this.layer.draw()}.bind(this)),e.on("mousedown touchstart",function(){t.setDraggable(!1),this.moveToTop()}),e.on("dragend",function(){t.setDraggable(!0),this.layer.draw()}.bind(this)),e.on("mouseover",function(){var t=this.getLayer();document.body.style.cursor="pointer",e.setStrokeWidth(4),t.draw()}),e.on("mouseout",function(){var t=this.getLayer();document.body.style.cursor="default",this.setStrokeWidth(2),t.draw()}),t.add(e)},clearCanvas:function(t,e,n){t=t||this.instance.getContext("2d"),e=e||this.instance.width,n=n||this.instance.height,t.clearRect(0,0,e,n)},process:function(t){time.clear(),this.canvas=new Canvas(this.instance,parseInt(this.instance.getAttribute("width")),parseInt(this.instance.getAttribute("height")));var e=new Canny(this.canvas),n=new Filters(this.canvas);this.contourFinder=new ContourFinder,time.start("Gray Scale"),this.canvas.setImgData(n.grayscale()),time.end("Gray Scale"),time.start("Gaussian Blur"),this.canvas.setImgData(n.gaussianBlur(5,1)),time.end("Gaussian Blur"),time.start("Canny Grdient"),this.canvas.setImgData(e.gradient("sobel")),time.end("Canny Grdient"),time.start("Canny non-Maximum Suppress"),this.canvas.setImgData(e.nonMaximumSuppress()),time.end("Canny non-Maximum Suppress"),time.start("Canny Hysteresis"),this.canvas.setImgData(e.hysteresis()),time.end("Canny Hysteresis"),time.start("Find Contours");for(var a=0;a<this.imgs.length;a++){var s=1;this.contourFinder.init(this.canvas.getCanvas(),this.imgs[a].group.attrs.x+("undefined"==typeof this.imgs[a].group.get("Image")[0].attrs.x?0:this.imgs[a].group.get("Image")[0].attrs.x)-s,this.imgs[a].group.attrs.y+("undefined"==typeof this.imgs[a].group.get("Image")[0].attrs.y?0:this.imgs[a].group.get("Image")[0].attrs.y)-s,this.imgs[a].group.get("Image")[0].attrs.width+2*s,this.imgs[a].group.get("Image")[0].attrs.height+2*s);var i=this.contourFinder.findContours();this.pathSum+=i.length,this.imgs[a].paths=i}time.end("Find Contours"),time.mark('Contour Number: <span class="font-a10000 font-bold">'+this.pathSum+"</span>");for(var r=[],o=0,h=0,c=0;c<this.imgs.length;c++){r[c]=[];for(var a=0;a<this.imgs[c].paths.length;a++){for(var d=this.imgs[c].paths[a],g="M",u=0;u<d.length;u+=2)g+=d[u].x+o+","+(d[u].y+h)+"  ",this.pointSum++;var l=document.createElementNS("http://www.w3.org/2000/svg","path");l.setAttribute("d",g.trim()),r[c].push(l)}}if(t(),0!==r.length){var m=document.getElementById("process__type"),v=m.options[m.selectedIndex].value;switch(v){case"preview":time.start("Draw"),this.preview(r);break;case"save":this.save(r)}}},preview:function(t){this.drawContours(this.canvas,t)},save:function(t){this.drawContours(this.canvas,t,!0)},canvasSaveState:function(t,e){if(e)n=e,n.getContext("2d").drawImage(t.canvas,0,0);else{var n=document.createElement("canvas");n.width=t.canvas.width,n.height=t.canvas.height,n.getContext("2d").drawImage(t.canvas,0,0)}return n},canvasRestoreState:function(t,e){e&&t.drawImage(e,0,0)},drawContours:function(t,e,n){n=n||!1,this.contextStates=null;for(var a=0;a<e.length;a++)e[a].sort(function(t,e){return e.getTotalLength()-t.getTotalLength()});this.clearCanvas();var s=this.layer.getContext(),i=function(t,e){for(var n=this.layer.get("Group"),a=0;a<n.length;a++)a>e&&n[a].opacity(0);n[e].opacity(t),this.layer.draw(),this.contextStates&&this.canvasRestoreState(s._context,this.contextStates)}.bind(this),r=10,o=1e3,h=[];n&&!this.capturer&&(this.capturer=new CCapture({verbose:!1,display:!1,framerate:o,format:"webm",frameLimit:0,bakckgroundColor:"#fff",onProcess:function(t){time.mark('Capturing Frame Number: <span class="font-a10000 font-bold">'+t+"</span>","frameCount")}}));var c=.5,d=null,g={x:63,y:208,ele:document.getElementById("nib")},u=function(){this.clearCanvas(),s.beginPath(),s.moveTo(h[0].x,h[0].y);for(var t=1;t<h.length;t++)s.lineTo(h[t].x,h[t].y);d&&this.canvasRestoreState(s._context,d),s.stroke(),d=this.canvasSaveState(s._context,d),this.contextStates&&s.drawImage(this.contextStates,0,0),s.drawImage(g.ele,h[t-1].x-g.x,h[t-1].y-g.y),this.capturer&&this.capturer.capture(this.instance)}.bind(this),l=function(t){this.capturer&&this.capturer.capture(this.instance);for(var a=0,g=0;g<e.length;g++)a+=e[g].length;if(time.mark('Process: <span class="font-a10000 font-bold">'+((this.pathSum-a)/this.pathSum*98).toFixed(2)+"%</span>","process"),0!==e[t].length){var m=e[t].splice(0,1);if(h=[],d&&(this.contextStates?this.contextStates.getContext("2d").drawImage(d,0,0):this.contextStates=d),d=null,s.lineWidth=c,s.strokeStyle="#000",this.capturer){var v=function(){var e=h.length*r,n=m[0].getTotalLength();n>=e?(h.push(m[0].getPointAtLength(e)),u(),requestAnimationFrame(v)):l(t)};v()}else var p=setInterval(function(){var e=h.length*r,n=m[0].getTotalLength();n>=e?(h.push(m[0].getPointAtLength(e)),u()):(clearInterval(p),l(t))},1e3/o/m[0].getTotalLength())}else{var f=document.getElementById("process__draw-color").checked,y=0;if(n){var b=function(){y+=f?.01:1,i(f?y:0,t),this.capturer&&this.capturer.capture(this.instance),y>=1?"undefined"!=typeof e[t+1]?(this.contextStates&&this.contextStates.getContext("2d").drawImage(s._context.canvas,0,0),l(t+1)):(this.capturer&&(this.capturer.stop(),this.capturer.save(),this.capturer=null),time.end("Draw"),time.mark('Process: <span class="font-a10000 font-bold">100%</span>',"process")):requestAnimationFrame(b)}.bind(this);b()}else var w=setInterval(function(){y+=f?.01:1,i(f?y:0,t),y>=1&&("undefined"!=typeof e[t+1]?(this.contextStates&&this.contextStates.getContext("2d").drawImage(s._context.canvas,0,0),l(t+1)):(time.end("Draw"),time.mark('Process: <span class="font-a10000 font-bold">100%</span>',"process")),clearInterval(w))}.bind(this),1e3/o)}}.bind(this);n&&this.capturer.start(),l(0)}};!function(){const t=73,e=window.innerWidth,n=window.navigator.userAgent.toLowerCase().indexOf("micromessenger")>-1?window.innerHeight-t:window.innerHeight;document.querySelectorAll(".container")[0].style.height=n+"px",canvasObj.init(document.querySelectorAll(".container")[0],e-26-350,6*n/7);var a=document.getElementById("process__button"),s=document.getElementById("clear__button"),i=document.getElementById("process__draw-color"),r=function(){a.className="button button__inline button__disabled",a.removeEventListener("click",r),setTimeout(function(){for(var t=(console,document.querySelectorAll(".container__info")[0]),e=t.children.length,n=0;e>n;n++)t.removeChild(t.children[0]);new Promise(function(){for(var t=0;t<canvasObj.imgs.length;t++)for(var e=canvasObj.imgs[t].group.children.length,n=0,s=0;e>s;s++){var i=canvasObj.imgs[t].group.children[s];"Circle"===i.className?(i.hide(),canvasObj.layer.draw()):n++}canvasObj.process(function(){a.className="button button__inline",a.addEventListener("click",r)})})},500)},o=function(){Object.assign(canvasObj,{imgs:[],canvas:null,contourFinder:null,pathSum:0,pointSum:0,contextStates:null}),canvasObj.layer.destroyChildren().draw()};a.addEventListener("click",r),s.addEventListener("click",o),i.addEventListener("change",function(){document.querySelectorAll(".checkbox__color")[0].className=this.checked?"checkbox__color checkbox__color-selected":"checkbox__color"})}();