window.Whammy=(function(){function k(C,p){var s=i(C);var B=30000;var t=[{"id":440786851,"data":[{"data":1,"id":17030},{"data":1,"id":17143},{"data":4,"id":17138},{"data":8,"id":17139},{"data":"webm","id":17026},{"data":2,"id":17031},{"data":2,"id":17029}]},{"id":408125543,"data":[{"id":357149030,"data":[{"data":1000000,"id":2807729},{"data":"whammy","id":19840},{"data":"whammy","id":22337},{"data":a(s.duration),"id":17545}]},{"id":374648427,"data":[{"id":174,"data":[{"data":1,"id":215},{"data":1,"id":29637},{"data":0,"id":156},{"data":"und","id":2274716},{"data":"V_VP8","id":134},{"data":"VP8","id":2459272},{"data":1,"id":131},{"id":224,"data":[{"data":s.width,"id":176},{"data":s.height,"id":186}]}]}]},{"id":475249515,"data":[]}]}];var z=t[1];var y=z.data[2];var D=0;var F=0;while(D<C.length){var u={"id":187,"data":[{"data":Math.round(F),"id":179},{"id":183,"data":[{"data":1,"id":247},{"data":0,"size":8,"id":241}]}]};y.data.push(u);var A=[];var r=0;do{A.push(C[D]);r+=C[D].duration;D++}while(D<C.length&&r<B);var q=0;var E={"id":524531317,"data":[{"data":Math.round(F),"id":231}].concat(A.map(function(G){var H=n({discardable:0,frame:G.data.slice(4),invisible:0,keyframe:1,lacing:0,trackNum:1,timecode:Math.round(q)});q+=G.duration;return{data:H,id:163}}))};z.data.push(E);F+=r}var x=0;for(var w=0;w<z.data.length;w++){if(w>=3){y.data[w-3].data[1].data[1].data=x}var v=l([z.data[w]],p);x+=v.size||v.byteLength||v.length;if(w!=2){z.data[w]=v}}return l(t,p)}function i(t){var r=t[0].width,p=t[0].height,s=t[0].duration;for(var q=1;q<t.length;q++){if(t[q].width!=r){throw"Frame "+(q+1)+" has a different width"}if(t[q].height!=p){throw"Frame "+(q+1)+" has a different height"}if(t[q].duration<0||t[q].duration>32767){throw"Frame "+(q+1)+" has a weird duration (must be between 0 and 32767)"}s+=t[q].duration}return{duration:s,width:r,height:p}}function b(p){var q=[];while(p>0){q.push(p&255);p=p>>8}return new Uint8Array(q.reverse())}function j(p,r){var s=new Uint8Array(r);for(var q=r-1;q>=0;q--){s[q]=p&255;p=p>>8}return s}function h(r){var p=new Uint8Array(r.length);for(var q=0;q<r.length;q++){p[q]=r.charCodeAt(q)}return p}function d(r){var q=[];var s=(r.length%8)?(new Array(1+8-(r.length%8))).join("0"):"";r=s+r;for(var p=0;p<r.length;p+=8){q.push(parseInt(r.substr(p,8),2))}return new Uint8Array(q)}function l(D,p){var t=[];for(var x=0;x<D.length;x++){if(!("id" in D[x])){t.push(D[x]);continue}var w=D[x].data;if(typeof w=="object"){w=l(w,p)}if(typeof w=="number"){w=("size" in D[x])?j(w,D[x].size):d(w.toString(2))}if(typeof w=="string"){w=h(w)}if(w.length){var A=A}var y=w.size||w.byteLength||w.length;var B=0;for(var v=56;v>0;v-=7){if(y>Math.pow(2,v)-2){B=v/7;break}}var C=y.toString(2);var r=(new Array(8*(B+1)+1)).join("0");var s=(new Array(B+1)).join("0")+1;var q=r.substr(0,r.length-C.length-s.length)+C;var E=s+q;t.push(b(D[x].id));t.push(d(E));t.push(w)}if(p){var u=m(t);return new Uint8Array(u)}else{return new Blob(t,{type:"video/webm"})}}function m(p,r){if(r==null){r=[]}for(var q=0;q<p.length;q++){if(typeof p[q]=="object"){m(p[q],r)}else{r.push(p[q])}}return r}function e(r){var q="";var s=(r.length%8)?(new Array(1+8-(r.length%8))).join("0"):"";r=s+r;for(var p=0;p<r.length;p+=8){q+=String.fromCharCode(parseInt(r.substr(p,8),2))}return q}function o(w){var q="";for(var s=0;s<w.length;s++){var r=w[s].data;if(typeof r=="object"){r=o(r)}if(typeof r=="number"){r=e(r.toString(2))}var t=r.length;var u=Math.ceil(Math.ceil(Math.log(t)/Math.log(2))/8);var v=t.toString(2);var p=(new Array((u*7+7+1)-v.length)).join("0")+v;var x=(new Array(u)).join("0")+"1"+p;q+=e(w[s].id.toString(2))+e(x)+r}return q}function n(r){var p=0;if(r.keyframe){p|=128}if(r.invisible){p|=8}if(r.lacing){p|=(r.lacing<<1)}if(r.discardable){p|=1}if(r.trackNum>127){throw"TrackNumber > 127 not supported"}var q=[r.trackNum|128,r.timecode>>8,r.timecode&255,p].map(function(s){return String.fromCharCode(s)}).join("")+r.frame;return q}function c(q){var u=q.RIFF[0].WEBP[0];var w=u.indexOf("\x9d\x01\x2a");for(var t=0,v=[];t<4;t++){v[t]=u.charCodeAt(w+3+t)}var p,r,y,x,s;s=(v[1]<<8)|v[0];p=s&16383;r=s>>14;s=(v[3]<<8)|v[2];y=s&16383;x=s>>14;return{width:p,height:y,data:u,riff:q}}function f(q){var s=0;var u={};while(s<q.length){var t=q.substr(s,4);u[t]=u[t]||[];if(t=="RIFF"||t=="LIST"){var p=parseInt(q.substr(s+4,4).split("").map(function(v){var w=v.charCodeAt(0).toString(2);return(new Array(8-w.length+1)).join("0")+w}).join(""),2);var r=q.substr(s+4+4,p);s+=4+4+p;u[t].push(f(r))}else{if(t=="WEBP"){u[t].push(q.substr(s+8));s=q.length}else{u[t].push(q.substr(s+4));s=q.length}}}return u}function a(p){return[].slice.call(new Uint8Array((new Float64Array([p])).buffer),0).map(function(q){return String.fromCharCode(q)}).reverse().join("")}function g(p,q){this.frames=[];this.duration=1000/p;this.quality=q||0.8}g.prototype.add=function(q,p){if(typeof p!="undefined"&&this.duration){throw"you can't pass a duration if the fps is set"}if(typeof p=="undefined"&&!this.duration){throw"if you don't have the fps set, you need to have durations here."
}if(q.canvas){q=q.canvas}if(q.toDataURL){q=q.getContext("2d").getImageData(0,0,q.width,q.height)}else{if(typeof q!="string"){throw"frame must be a a HTMLCanvasElement, a CanvasRenderingContext2D or a DataURI formatted string"}}if(typeof q==="string"&&!(/^data:image\/webp;base64,/ig).test(q)){throw"Input must be formatted properly as a base64 encoded DataURI of type image/webp"}this.frames.push({image:q,duration:p||this.duration})};g.prototype.encodeFrames=function(t){if(this.frames[0].image instanceof ImageData){var s=this.frames;var p=document.createElement("canvas");var q=p.getContext("2d");p.width=this.frames[0].image.width;p.height=this.frames[0].image.height;var r=function(u){var v=s[u];q.putImageData(v.image,0,0);v.image=p.toDataURL("image/webp",this.quality);if(u<s.length-1){setTimeout(function(){r(u+1)},1)}else{t()}}.bind(this);r(0)}else{t()}};g.prototype.compile=function(p,q){this.encodeFrames(function(){var r=new k(this.frames.map(function(t){var s=c(f(atob(t.image.slice(23))));s.duration=t.duration;return s}),p);q(r)}.bind(this))};return{Video:g,fromImageArray:function(p,r,q){return k(p.map(function(t){var s=c(f(atob(t.slice(23))));s.duration=1000/r;return s}),q)},toWebM:k}})();